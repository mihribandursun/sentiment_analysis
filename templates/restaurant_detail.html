<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>{{ restaurant.restaurant_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .review-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .delete-btn {
            background: transparent;
            border: none;
            color: red;
            cursor: pointer;
            font-size: 1.2em;
        }
        .delete-btn:hover {
            color: darkred;
        }
    </style>
</head>
<body>

<a href="/" class="back-btn">â¬… Geri</a>

<div class="detail-container">

    {% if restaurant.img %}
        <img src="{{ restaurant.img }}" class="detail-img">
    {% endif %}

    <h1>{{ restaurant.restaurant_name }}</h1>
    <p>{{ restaurant.district }}</p>

    <div class="info">
        <span>â­ {{ restaurant.avg_rating | round(1) }}</span>
        <span>ğŸ½ {{ restaurant.cuisine_type }}</span>
        <span>ğŸšš {{ restaurant.delivery_time }}</span>
        <span>ğŸ’° {{ restaurant.price_range }}</span>
        <span>ğŸ“ {{ restaurant.total_reviews }} yorum</span>
    </div>

    <div class="sentiment detail-sentiment">
        <span class="positive">ğŸŸ¢ {{ restaurant.positive_pct }}%</span>
        <span class="negative">ğŸ”´ {{ restaurant.negative_pct }}%</span>
    </div>

</div>

<hr>

<h2>âœï¸ Yorum Yaz</h2>
<form method="post" class="review-form">
    <textarea name="review_text" placeholder="Yorumunuzu yazÄ±n..." required></textarea>
    <button type="submit">GÃ¶nder</button>
</form>

<hr>

<h2>ğŸ’¬ KullanÄ±cÄ± YorumlarÄ±</h2>

<div class="reviews">
    {% for r in user_reviews %}
    <div class="review-card {% if r.sentiment == 1 %}positive-border{% else %}negative-border{% endif %}">
        <div class="review-header">
            <strong>{{ r.username }}</strong>
            <span class="date">{{ r.created_at.strftime('%d.%m.%Y') }}</span>

            {% if session['user_id'] == r.user_id %}
            <form method="POST" action="{{ url_for('restaurant_detail', vendor_id=restaurant.vendor_id) }}" style="display:inline-block; margin-left:auto;">
                <input type="hidden" name="delete_review_id" value="{{ r.id }}">
                <button type="submit" class="delete-btn">ğŸ—‘ï¸</button>
            </form>
            {% endif %}
        </div>
        <p class="review-text">{{ r.review_text }}</p>
        <div class="review-footer">
            <div class="sentiment-badge {{ 'positive' if r.sentiment == 1 else 'negative' }}">
                {{ 'ğŸŸ¢ Pozitif' if r.sentiment == 1 else 'ğŸ”´ Negatif' }}
                <span class="confidence">(%{{ r.confidence }} gÃ¼ven)</span>
            </div>
        </div>

    </div>
    {% endfor %}

    {% for r in reviews %}
    <div class="review-card {% if r.sentiment == 1 %}positive-border{% else %}negative-border{% endif %}">
        <div class="review-header">
            <strong>{{ r.reviewer_name }}</strong>
            <span class="date">{{ r.created_at.strftime('%d.%m.%Y') }}</span>
        </div>
        <p class="review-text">{{ r.review_text }}</p>
        <div class="review-footer">
            <div class="sentiment-badge {{ 'positive' if r.sentiment == 1 else 'negative' }}">
                {{ 'ğŸŸ¢ Pozitif' if r.sentiment == 1 else 'ğŸ”´ Negatif' }}
            </div>
        </div>

    </div>
    {% endfor %}
</div>

<hr>

<div class="pagination">
    {% if page > 1 %}
        <a href="?page={{ page - 1 }}">â¬… Ã–nceki</a>
    {% endif %}
    <span>Sayfa {{ page }} / {{ total_pages }}</span>
    {% if page < total_pages %}
        <a href="?page={{ page + 1 }}">Sonraki â¡</a>
    {% endif %}
</div>

</body>
</html>
